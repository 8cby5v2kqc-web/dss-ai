<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Rich Picture</title>
    <style>
        body {
            margin: 0;
            min-height: 100vh;
            background: #2d2d2d;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Segoe UI', sans-serif;
        }
        canvas {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.6);
            display: block;
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <canvas id="richCanvas" width="1200" height="800"></canvas>

    <script>
        (function() {
            const canvas = document.getElementById('richCanvas');
            const ctx = canvas.getContext('2d');

            // === Вспомогательная функция для скруглённого прямоугольника ===
            CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
                if (w < 2 * r) r = w / 2;
                if (h < 2 * r) r = h / 2;
                this.moveTo(x + r, y);
                this.lineTo(x + w - r, y);
                this.quadraticCurveTo(x + w, y, x + w, y + r);
                this.lineTo(x + w, y + h - r);
                this.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
                this.lineTo(x + r, y + h);
                this.quadraticCurveTo(x, y + h, x, y + h - r);
                this.lineTo(x, y + r);
                this.quadraticCurveTo(x, y, x + r, y);
                return this;
            };

            // === Функция рисования прямоугольника ===
            function drawRect(x, y, w, h, title, lines, color) {
                ctx.fillStyle = color;
                ctx.shadowColor = 'rgba(0,0,0,0.2)';
                ctx.shadowBlur = 8;
                ctx.shadowOffsetX = 3;
                ctx.shadowOffsetY = 3;
                ctx.beginPath();
                ctx.roundRect(x, y, w, h, 12);
                ctx.fill();
                ctx.shadowColor = 'transparent';
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 1.5;
                ctx.stroke();

                ctx.font = 'bold 20px "Times New Roman", serif';
                ctx.fillStyle = '#000';
                ctx.textAlign = 'center';
                ctx.fillText(title, x + w/2, y + 32);

                ctx.font = '16px "Times New Roman", serif';
                ctx.fillStyle = '#222';
                for (let i = 0; i < lines.length; i++) {
                    ctx.fillText(lines[i], x + w/2, y + 65 + i * 24);
                }
            }

            // === Функция рисования облака ===
            function drawCloud(x, y, w, h, lines, color) {
                ctx.fillStyle = color;
                ctx.shadowColor = 'rgba(0,0,0,0.15)';
                ctx.shadowBlur = 8;
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
                ctx.beginPath();
                ctx.ellipse(x, y, w/2, h/2, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowColor = 'transparent';
                ctx.strokeStyle = '#888';
                ctx.lineWidth = 1.5;
                ctx.stroke();

                ctx.font = '16px "Times New Roman", serif';
                ctx.fillStyle = '#000';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                let startY = y - (lines.length-1) * 12;
                for (let i = 0; i < lines.length; i++) {
                    ctx.fillText(lines[i], x, startY + i * 24);
                }
            }

            // === Функция рисования стрелки ===
            function drawArrow(x1, y1, x2, y2, label, color = '#555', dashed = false) {
                ctx.beginPath();
                ctx.strokeStyle = color;
                ctx.lineWidth = 2.5;
                ctx.setLineDash(dashed ? [8, 6] : []);
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.stroke();
                ctx.setLineDash([]);

                const angle = Math.atan2(y2 - y1, x2 - x1);
                const arrowSize = 14;
                const dx = arrowSize * 0.7 * Math.cos(angle - 0.3);
                const dy = arrowSize * 0.7 * Math.sin(angle - 0.3);
                const dx2 = arrowSize * 0.7 * Math.cos(angle + 0.3);
                const dy2 = arrowSize * 0.7 * Math.sin(angle + 0.3);
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.moveTo(x2, y2);
                ctx.lineTo(x2 - dx, y2 - dy);
                ctx.lineTo(x2 - dx2, y2 - dy2);
                ctx.closePath();
                ctx.fill();

                if (label) {
                    ctx.font = 'italic 16px "Times New Roman", serif';
                    ctx.fillStyle = '#333';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'bottom';
                    const midX = (x1 + x2) / 2;
                    const midY = (y1 + y2) / 2 - 12;
                    const lines = label.split('\n');
                    for (let i = 0; i < lines.length; i++) {
                        ctx.fillText(lines[i], midX, midY + i * 22);
                    }
                }
            }

            // === Отрисовка всех элементов ===
            // Клиент
            drawRect(50, 200, 180, 160, 'Клиент', [
                'тревога/депрессия',
                'сомнения, стигма',
                'ведёт дневник',
                '(бумага/телефон)'
            ], '#bbdefb');

            // Психолог
            drawRect(970, 200, 180, 160, 'Психолог', [
                'сессии, опросники',
                '(Beck, GAD-7)',
                'ручная обработка',
                'бумажные карты'
            ], '#c8e6c9');

            // Платформа
            drawRect(450, 220, 300, 220, 'Защищенная платформа', [
                '• Эл. опросники (автоподсчёт)',
                '• Безопасный дневник',
                '• Панель психолога',
                '• Шифрование и доступ'
            ], '#ffe0b2');

            // Облака проблем
            drawCloud(1060, 100, 200, 60, ['Ручная обработка →', 'ошибки до 15%'], '#ffccbc');
            drawCloud(600, 60, 280, 70, ['Нет структурированного', 'наблюдения между сессиями'], '#ffe0b2');
            drawCloud(140, 100, 200, 60, ['Риск утечки', 'конфиденциальных данных'], '#ffab91');

            // Стрелки
            drawArrow(230, 330, 970, 330, 'Сессии', '#2c3e50');
            drawArrow(230, 280, 450, 300, 'Заполняет скрининги,\nведёт дневник', '#2e7d32');
            drawArrow(970, 280, 750, 320, 'Получает отчёты,\nотслеживает динамику', '#2e7d32');
        })();
    </script>
</body>
</html>
